{{ 'section-announcement-bar.css' | asset_url | stylesheet_tag }}

{%- assign marquee_slide_blocks = section.blocks | where: 'type', 'marquee_slide' -%}
{%- assign link_blocks = section.blocks | where: 'type', 'link' -%}

<div class="announcement-bar" role="region" aria-label="{{ 'sections.header.announcement' | t }}">
  <div class="announcement-bar__wrapper page-width">
    
    {%- if marquee_slide_blocks.size > 0 -%}
      <div class="announcement_bar__marquee enable-animation">
        {% capture marquee_content %}
          {%- for block in marquee_slide_blocks -%}
            <li class="marquee__item">
              {%- if block.settings.icon != 'none' -%}
                {% render 'icon', icon: block.settings.icon %}
                <span class="visual-hidden">Icon</span>
              {%- endif -%}
              <span>{{ block.settings.content }}</span>
            </li>
          {%- endfor -%}
        {% endcapture %}

        <ul class="marquee__content">
          {{ marquee_content }}
          {{ marquee_content }}
          {{ marquee_content }}
        </ul>
      </div>
    {%- endif -%}

    {%- for block in link_blocks -%}
      <a href="{{ block.settings.link }}" class="announcement-bar__static-link">
        {%- if block.settings.custom_icon != blank -%}
             <img src="{{ block.settings.custom_icon | image_url: width: 20 }}" alt="{{ block.settings.link_label }}" width="20" height="20">
        {%- elsif block.settings.icon != 'none' -%}
            {% render 'icon', icon_name: block.settings.icon %}
        {%- endif -%}
        {{ block.settings.link_label }}
      </a>
    {%- endfor -%}

  </div>
</div>

{% schema %}
{
  "name": "Custom Announcement Bar",
  "settings": [
    {
      "type": "color",
      "id": "color_bg",
      "label": "Background Color",
      "default": "#A3CA6D"
    },
    {
      "type": "color",
      "id": "color_text",
      "label": "Text Color",
      "default": "#FFFFFF"
    }
  ],
  "blocks": [
    {
      "type": "marquee_slide",
      "name": "Marquee Text",
      "settings": [
        {
          "type": "text",
          "id": "content",
          "label": "Text",
          "default": "Welcome to our store"
        },
        {
          "type": "text",
          "id": "icon",
          "label": "Icon Name (optional)",
          "default": "none"
        }
      ]
    },
    {
      "type": "link",
      "name": "Static Link",
      "limit": 1,
      "settings": [
        {
          "type": "text",
          "id": "link_label",
          "label": "Label",
          "default": "New Products"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Link"
        },
        {
          "type": "text",
          "id": "icon",
          "label": "Icon Name",
          "default": "star"
        },
        {
           "type": "image_picker",
           "id": "custom_icon",
           "label": "Custom Icon"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Custom Announcement Bar",
      "blocks": [
        {
          "type": "marquee_slide"
        },
        {
           "type": "link"
        }
      ]
    }
  ]
}
{% endschema %}
